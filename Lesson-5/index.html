<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Chess</title>

  <style>
    #field {
      width: 400px;
      height: 400px;
      margin: 0 auto;
      user-select: none;
    }
    #field div {
      position: relative;
      float: left;
      width: 12.5%;
      height: 12.5%;
      text-align: center;
      box-sizing: border-box;
    }
    #field {
      background-image:
        linear-gradient(45deg, burlywood 25%, transparent 25%),
        linear-gradient(-45deg, burlywood 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, burlywood 75%),
        linear-gradient(-45deg, transparent 75%, burlywood 75%);
      background-size: 25% 25%;
      background-position: 0 0, 0 16.64%, 16.64% -16.64%, -16.64% 0;
    }
    #field>div>em {
      position: absolute;
      font: bold 10px Verdana;
    }
    #field div .top {
      left: 3px;
      transform: rotate(180deg);
    }
    #field div .right {
      transform: rotate(180deg);
      right: 3px;
    }
    #field div .bottom {
      bottom: 0;
      right: 3px;
    }
    #field div .left {
      left: 3px;
      bottom: 0;
    }
    #field div span {
      display: block;
      width: 100%;
      height: 100%;
      font: 35px Verdana;
      cursor: pointer;
    }
    span:nth-child(1) {
      /* color: red; */
    }
    .select {
      border: 2px solid #1fc41f;
    }
    #field div span:hover {
      outline: 1px solid #1fc41f;
    }
    .moved:after {
      height: 100%;
      width: 100%;
      background-color: #1fc41f;
      opacity: 0.5;
    }
    #field div span:moved {
      /* outline: 1px solid #1fc41f; */
    }

  </style>
</head>

<body>

  <div id="field"></div>

  <script>

    "use strict"

    var fieldDOM = document.getElementById("field"), cellsDOM = [], numNotation = 8, selectedCell = -1;

    var field = [
      {n:'R',side:0,form:'&#9820;'}, {n:'N',side:0,form:'&#9822;'},
      {n:'B',side:0,form:'&#9821;'}, {n:'Q',side:0,form:'&#9819;'},
      {n:'K',side:0,form:'&#9818;'}, {n:'B',side:0,form:'&#9821;'},
      {n:'N',side:0,form:'&#9822;'}, {n:'R',side:0,form:'&#9820;'},
      {n:'p',side:0,form:'&#9823;'}, {n:'p',side:0,form:'&#9823;'},
      {n:'p',side:0,form:'&#9823;'}, {n:'p',side:0,form:'&#9823;'},
      {n:'p',side:0,form:'&#9823;'}, {n:'p',side:0,form:'&#9823;'},
      {n:'p',side:0,form:'&#9823;'}, {n:'p',side:0,form:'&#9823;'},
      {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, 
      {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, 
      {n:'p',side:1,form:'&#9817;'}, {n:'p',side:1,form:'&#9817;'},
      {n:'p',side:1,form:'&#9817;'}, {n:'p',side:1,form:'&#9817;'},
      {n:'p',side:1,form:'&#9817;'}, {n:'p',side:1,form:'&#9817;'},
      {n:'p',side:1,form:'&#9817;'}, {n:'p',side:1,form:'&#9817;'},
      {n:'R',side:1,form:'&#9814;'}, {n:'N',side:1,form:'&#9816;'},
      {n:'B',side:1,form:'&#9815;'}, {n:'Q',side:1,form:'&#9813;'},
      {n:'K',side:1,form:'&#9812;'}, {n:'B',side:1,form:'&#9815;'},
      {n:'N',side:1,form:'&#9816;'}, {n:'R',side:1,form:'&#9814;'},
    ];

    var availableMoves = {
      K: [1,+9,+8,+7,+1,-1,-7,-8,-9], 
      Q: [0,+9,+8,+7,+1,-1,-7,-8,-9],
      R: [0,+8,+1,-1,-8], 
      B: [0,+9,+7,-7,-9],
      N: [1,+17,+15,+10,+6,-6,-10,-15,-17],
      p: [1,+16,+8,-8,-16]
    };

    // Инициализация поля, отображение нотации и расстановка фигур

    for (var i = 0; i < 64; i++) {
      cellsDOM[i] = document.createElement("div");

      displayNotation(cellsDOM[i], i);
      displayChess(cellsDOM[i], i);

      cellsDOM[i].addEventListener("click", selectedFigure);
      cellsDOM[i].setAttribute("xpos", i);

      fieldDOM.appendChild(cellsDOM[i]);
    }

    function displayChess(_cellDOM, i) {
        if (field[i].n != undefined) {
          var spanFigure = document.createElement("span");
          spanFigure.innerHTML = field[i].form;
          _cellDOM.appendChild(spanFigure);
        }
    }

    function renderDisaplayField(xposSelectCell) {
      
      for (var i = 0; i < 8 * 8; i++) {

        var span = cellsDOM[i].querySelector("span");
        
        if (span != undefined ) {
          cellsDOM[i].removeChild(span);
        }

        displayChess(cellsDOM[i], i)

        if (xposSelectCell != i) {
          cellsDOM[i].classList.remove("select");
        } else {
          cellsDOM[i].classList.add("select");
        }
      }
      
      displayMoves(xposSelectCell);
    }


    function displayMoves(xpos) {

      var nameFigure = field[xpos].n;
      var sideFigure = field[xpos].side;

      var moves = availableMoves[nameFigure];

      var direction;

      for (var i = 1; i < moves.length; i++) {

        direction = -1;

        if (nameFigure == 'p' && sideFigure == 0 && moves[i] > 0) {
          direction = +xpos + moves[i];
        }

        if (nameFigure == 'p' && sideFigure == 1 && moves[i] < 0) {
          direction = +xpos + moves[i];
        }

        if (nameFigure != 'p') {
          direction = +xpos + moves[i];
        }

        if(nameFigure == 'R'){
          console.log("R: xpos: " + xpos + " + " + moves[i] + " - " + direction)
        }

        if (direction >= 0 && direction <= 63) {
          cellsDOM[direction].classList.add("select");
        }
      }
    }


    function selectedFigure(event) {
      var target = event.target.closest("div");
      var _xpos = target.getAttribute("xpos");
      renderDisaplayField( _xpos );
    }

    function displayNotation(cell, i) {

      if (i >= 0 && i <= 7) {
        addElToLetterNum(cell, String.fromCharCode(i + 97), "top");
      }
      else if (i >= 56 && i <= 63) {
        addElToLetterNum(cell, String.fromCharCode(i + 97 - 56), "bottom");
      }
      if ((i+1) % 8 == 1) {
        addElToLetterNum(cell, numNotation, "left");
      }
      else if ((i+1) % 8 == 0) {
        addElToLetterNum(cell, numNotation--, "right");
      }

      function addElToLetterNum(cell, letterNum, className) {
        var span = document.createElement("em");
        span.className = className;
        span.innerHTML = letterNum;
        cell.appendChild(span);
      }
    }

    //  ... Дополнительные возможности ...

  </script>

</body>

</html>